  <link rel="stylesheet" href="/static/css/style_prototype.css">
  <div id="navbar">
    <div id="logo"><a href="/">Better Reads</a></div>
    <div class="user-actions">
      {{#if loggedIn}}
      <a href="/logout">Logout</a>
      <a href="/profile">Hello, {{my_username}}</a>
      {{else}}
      <a href="/login">Login</a>
      <a href="/register">Register</a>
      {{/if}}
    </div>
  </div>

  <div class="profile-container">
    <h1>{{username}}</h1>

    <!-- Mostrar foto de perfil o imagen gen√©rica si el perfil no est√° completo -->
    <img src="/static/{{profile_photo}}" alt="Profile Photo">
    
    <!-- Mostrar bio o un mensaje gen√©rico si no hay bio -->
    <div class="bio">
        <p>{{#if bio}}{{bio}}{{else}}No bio available.{{/if}}</p>
    </div>

    {{#if isOwnProfile}}
        <!-- Bot√≥n para mostrar el formulario de edici√≥n siempre que sea el perfil propio -->
        <button onclick="document.getElementById('edit-form').style.display='block'">Edit Profile</button>

        <!-- Formulario de edici√≥n (oculto hasta que se haga clic en el bot√≥n) -->
        <form id="edit-form" action="/profile" method="POST" enctype="multipart/form-data" style="display: none;">
            <label for="bio">Bio:</label>
            <textarea name="bio">{{bio}}</textarea>

            <label for="profile_photo">Upload Profile Photo:</label>
            <input type="file" name="profile_photo" accept="image/*" />

            <button type="submit">Update Profile</button>
        </form>
    {{/if}}
    
    <h2>Followers: {{followers.length}}</h2>
    <h2>Following: {{following.length}}</h2>
</div>
    </div>
    </div>
     {{#unless isOwnProfile}}
    <button id="follow-button" class="{{#if isFollowing}}unfollow{{/if}}" onclick="toggleFollow({{userId}})">
      {{#if isFollowing}}Unfollow{{else}}Follow{{/if}}
    </button>
  {{/unless}}

 <!-- Integrar el feed aqu√≠ -->
  <div id="container">
    <div id="feed">
      {{#if posts}}
      {{#each posts}}
      <div class="post" post-id="{{post_id}}">
        <div class="user-info">
            {{#if repost_username}}<strong class="repost-indicator"><a href="/{{repost_username}}/profile">@{{repost_username}}</a> ‚•Ç</strong> {{/if}}<strong><a href="/{{username}}/profile">@{{username}}</a></strong> on <a href="/book/{{book_id}}" class="topic-link"><em>{{book_name}}</em></a>
          </div>
        <div class="review">
          {{content}}
        </div>
        <div class="post-actions">
          <div style="display: flex; align-items: center;">
            <a href="#" class="like-button"><span class="like-counter" style="margin-right: 8px;">ü§ç ?</span></a>
            <a href="#" class="repost-button"><span class="repost-counter" style="margin-right: 8px;">üîÅ ?</span></a>
            <span class="comment-counter" style="margin-right: 8px;">üì© ?</span>
          </div>
          <a href="/post/{{post_id}}">Comments</a>
        </div>
      </div>
      {{/each}}
      {{#if has_more}}
       <a href="/following-posts?offset={{posts.length}}">Load more posts</a>
      {{else}}
      <p>You have reached the bottom! There are no more older posts</p>
      {{/if}}
      {{else}}
      <p>No posts yet</p>
      {{/if}}
    </div>
    </div>

  <script src="/static/js/updateLikes.js" type="text/javascript"></script>
  <script src="/static/js/like.js" type="text/javascript" event_listener_location="feed"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>


<script>
  let isFollowing = {{isFollowing}}; 
  async function toggleFollow(userId) {
    const button = document.getElementById('follow-button');
    const url = isFollowing ? `/unfollow/${userId}` : `/follow/${userId}`; 

    try {
     const response = await fetch(url, {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json'
     }
     });

     if (response.ok) {
       
       button.innerText = isFollowing ? 'Follow' : 'Unfollow';
       isFollowing = !isFollowing; 
       if (isFollowing) {
        button.classList.add('unfollow');
      } else {
        button.classList.remove('unfollow');
      }
      } else {
       const errorData = await response.json();
       alert(`Error: ${errorData.error}`);
      }
     } catch (error) {
      alert(`Request failed: ${error.message}`);
     }
}
</script>

