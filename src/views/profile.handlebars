<link rel="stylesheet" href="/static/css/style_prototype.css">

  <div class="profile-container">
    <h1 id="username-profile">{{username_profile}}</h1>

    <!-- Mostrar foto de perfil o imagen genérica si el perfil no está completo -->
    <img src="/static/{{profile_photo}}" alt="Profile Photo">
    
    <!-- Mostrar bio o un mensaje genérico si no hay bio -->
    <div class="bio">
        <p>{{#if bio}}{{bio}}{{else}}No bio available.{{/if}}</p>
    </div>

    {{#if isOwnProfile}}
        <!-- Botón para mostrar el formulario de edición siempre que sea el perfil propio -->
        <button onclick="document.getElementById('edit-form').style.display='block'">Edit Profile</button>

        <!-- Formulario de edición (oculto hasta que se haga clic en el botón) -->
        <form id="edit-form" action="/profile" method="POST" enctype="multipart/form-data" style="display: none;">
            <label for="bio">Bio:</label>
            <textarea name="bio">{{bio}}</textarea>

            <label for="profile_photo">Upload Profile Photo:</label>
            <input type="file" name="profile_photo" accept="image/*" />

            <button type="submit">Update Profile</button>
        </form>
    {{/if}}
    
     <div class="stats-container">
      <h2>Followers: {{followers.length}}</h2>
      <h2>Following: {{following.length}}</h2>
     </div>

     <button onclick="window.location.href='/{{userId}}/stats'">View Stats</button>

      {{#unless isOwnProfile}}
    <button id="follow-button" class="{{#if isFollowing}}unfollow{{/if}}" onclick="toggleFollow({{userId}})">
      {{#if isFollowing}}Unfollow{{else}}Follow{{/if}}
    </button>
  {{/unless}}
    
</div>
    </div>
    </div>
     

 <!-- Integrar el feed aquí -->
  <div id="container">
    {{> feed_of_posts}}

  <script src="/static/js/updateLikes.js" type="text/javascript"></script>
  <script src="/static/js/like.js" type="text/javascript" event_listener_location="feed"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>


<script>
  let isFollowing = {{isFollowing}}; 
  async function toggleFollow(userId) {
    const button = document.getElementById('follow-button');
    const url = isFollowing ? `/unfollow/${userId}` : `/follow/${userId}`; 

    try {
     const response = await fetch(url, {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json'
     }
     });

     if (response.ok) {
   
       button.innerText = isFollowing ? 'Follow' : 'Unfollow';
       isFollowing = !isFollowing; 
       if (isFollowing) {
        button.classList.add('unfollow');
      } else {
        button.classList.remove('unfollow');
      }
      } else {
       const errorData = await response.json();
       Swal.fire({
        icon: 'error',
        title: 'Error',
        text: errorData.error
      })
     
     } } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Request failed',
        text: error.message
      })
     }
}
</script>

