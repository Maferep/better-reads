<link rel="stylesheet" href="/static/css/style.css" />

<div id="browse-container">
  <h1>Browse Books</h1>

  <div id="book-list">
    <label for="book-select">Select a book:</label>
    <select name="book" id="book-select" style="width: 100%;">
      <option value="">-- Select a book --</option>
      {{#each bookEntries}}
        <option value="{{this.id}}">{{this.book_name}}</option>
      {{/each}}
    </select>
  </div>

  <button type="submit" onclick="return redirectToBook(event)">View Book</button>
</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script>
    $(document).ready(function() {
  $('#book-select').select2({
    placeholder: "-- Select a book --",
    ajax: {
      url: '/browse/search',
      dataType: 'json',
      delay: 300,
      data: function(params) {
        return {
          search: params.term 
        };
      },
      processResults: function(data) {
        return {
          results: data.bookEntries.map(book => ({
            id: book.id,
            text: book.book_name
          }))
        };
      },
      cache: true
    }
  });
});

function redirectToBook(event) {
    event.preventDefault();
    const select = document.getElementById('book-select');
    const bookId = select.value;
    if (bookId) {
        window.location.href = `/book/${bookId}`;
    } else {
        alert("Please select a book.");
    }
}
</script>
